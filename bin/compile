#!/bin/bash

if [ -z "$STYLESHEET_URL" ]; then
    echo "       Setting STYLESHEET_URL to default value"
    STYLESHEET_URL="https://gist.github.com/raw/4579178/styles.css"
fi

TEMPLATE_HEADER="<html><head><link href=\"$STYLESHEET_URL\" media=\"all\" rel=\"stylesheet\" type=\"text/css\" /></head><body>"
TEMPLATE_FOOTER="</body></html>"

cd $1

for file in *.md
do
  file=`readlink --no-newline --canonicalize $file`

  echo -n "       Sending $file to GitHub for rendering..."
  HTML=$(curl --data-binary @$file -H "Content-Type:text/plain" -s https://api.github.com/markdown/raw)
  echo $TEMPLATE_HEADER >> echo "$HTML" >> echo $TEMPLATE_FOOTER > $file.html
  rename s/.md// $file.html
  rm $file
  echo "done"
done
